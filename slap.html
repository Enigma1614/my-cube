<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·´æŒå°æ±ºï¼å•ªå•ªèˆ’å£“</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background: linear-gradient(135deg, #ff9a9e, #fecfef, #fecfef, #ff9a9e); 
            display: flex; 
            flex-direction: column; 
            min-height: 100vh;
            touch-action: manipulation;
        }

        /* é ‚éƒ¨åˆ—ï¼šè¿”å›å¤§å»³ */
        header {
            padding: 0 15px;
            height: 50px;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: 10px;
            background: rgba(0,0,0,0.15);
            border-bottom: 1px solid rgba(255,255,255,0.4);
            color: #fff;
        }
        .home-btn {
            text-decoration: none;
            font-size: 20px;
            color: #fff;
            background: rgba(255,255,255,0.18);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.4);
        }
        .game-title {
            font-weight: 800;
            text-shadow: 0 0 8px rgba(0,0,0,0.4);
        }

        /* ä¸»å€åŸŸï¼šç½®ä¸­ canvas */
        .game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px 0 20px;
        }

        canvas { 
            border: 5px solid #fff; 
            border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); 
            max-width: 100%; 
            max-height: 80vh; 
            background: #ffeaa7; 
        }

        @media (max-width: 480px) {
            header { height: 46px; padding: 0 10px; }
            .home-btn { width: 30px; height: 30px; font-size: 18px; }
            .game-title { font-size: 14px; }
            canvas { border-width: 3px; border-radius: 15px; }
        }
    </style>
</head>
<body>

    <header>
        <a href="index.html" class="home-btn">ğŸ </a>
        <div class="game-title">å·´æŒå°æ±º</div>
    </header>

    <div class="game-area">
        <canvas id="gameCanvas"></canvas>
    </div>

    <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // éŠæˆ²ç‹€æ…‹
    let score = 0;
    let face = { x: 0, y: 0, r: 80, shake: 0, red: 0, slapAnim: 0 };
    let particles = [];

    // RWD èª¿æ•´ç•«å¸ƒå¤§å°ï¼Œé †ä¾¿æ›´æ–°è‡‰çš„ä½ç½®èˆ‡å¤§å°
    function resizeCanvas() {
        const maxWidth = window.innerWidth - 40;
        const maxHeight = window.innerHeight - 120; // æ‰£æ‰ header & padding
        const size = Math.min(maxWidth, maxHeight);
        canvas.width = Math.min(size, 500);
        canvas.height = Math.min(canvas.width * 0.8, 400);

        face.r = canvas.width * 0.28;
        face.x = canvas.width / 2;
        face.y = canvas.height / 2 + 10;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function createParticles(x, y) {
        for (let i = 0; i < 10; i++) {
            particles.push({
                x, y,
                vx: (Math.random() - 0.5) * 20,
                vy: (Math.random() - 0.5) * 20 - 5,
                life: 1,
                color: `hsl(${Math.random() * 60 + 20}, 100%, 60%)`
            });
        }
    }

    function update() {
        face.shake *= 0.9;
        face.red *= 0.95;
        face.slapAnim *= 0.9;

        particles = particles.filter(p => {
            p.x += p.vx;
            p.y += p.vy;
            p.vy += 0.5;
            p.life -= 0.05;
            return p.life > 0;
        });
    }

    function drawFace() {
        ctx.save();
        ctx.translate(
            face.x + face.shake * (Math.random() - 0.5) * 12, 
            face.y + face.shake * (Math.random() - 0.5) * 12
        );

        // æ¯ 100 ä¸‹ä¸€å€‹å¤§éšæ®µï¼Œéšæ®µè¶Šé«˜è¡¨æƒ…è¶Šèª‡å¼µ
        const step = Math.min(Math.floor(score / 100), 3);   // 0~3 ç´š
        const within = score % 100;                          // 0~99
        const baseStepIntensity = step / 3;                  // 0, 0.33, 0.66, 1

        // å€é–“å…§æ¼¸é€²è®ŠåŒ–ï¼ˆ0~1ï¼‰
        const progress = within / 100;
        const micro = progress * progress;                   // å‰æ®µæ…¢ã€å¾Œæ®µå¿«
        const intensity = Math.min(baseStepIntensity + micro * (1/3), 1);

        // è‡‰åº•è‰² + ç´…æ½¤
        const baseLight = 50 + face.red + intensity * 10;
        ctx.fillStyle = `hsl(40, 70%, ${baseLight}%)`;
        ctx.beginPath();
        ctx.arc(0, 0, face.r, 0, Math.PI * 2);
        ctx.fill();

        // è…®ç´…
        ctx.fillStyle = `rgba(255, 99, 132, ${0.4 + intensity * 0.3})`;
        ctx.beginPath();
        ctx.ellipse(-face.r * 0.45, face.r * 0.1, face.r * 0.25, face.r * 0.15, 0, 0, Math.PI * 2);
        ctx.ellipse( face.r * 0.45, face.r * 0.1, face.r * 0.25, face.r * 0.15, 0, 0, Math.PI * 2);
        ctx.fill();

        const eyeY = -face.r * 0.28 + face.slapAnim * 6;
        const blink = face.slapAnim * (0.4 + intensity * 0.6);
        const eyeOpen = face.r * (0.18 - blink * 0.12);

        // çœ¼ç™½
        ctx.fillStyle = '#fff';
        ctx.beginPath();
        ctx.ellipse(-face.r * 0.3, eyeY, face.r * 0.22, Math.max(eyeOpen, 2), 0, 0, Math.PI * 2);
        ctx.ellipse( face.r * 0.3, eyeY, face.r * 0.22, Math.max(eyeOpen, 2), 0, 0, Math.PI * 2);
        ctx.fill();

        // ç³å­”
        ctx.fillStyle = '#000';
        const pupilBase = face.r * 0.08;
        const pupilSize = Math.max(pupilBase - blink * (pupilBase * 0.7), 2);
        ctx.beginPath();
        ctx.arc(-face.r * 0.3 + face.slapAnim * (5 + intensity * 8), eyeY, pupilSize, 0, Math.PI * 2);
        ctx.arc( face.r * 0.3 - face.slapAnim * (5 + intensity * 8), eyeY, pupilSize, 0, Math.PI * 2);
        ctx.fill();

        // çœ‰æ¯›
        ctx.strokeStyle = '#000';
        ctx.lineWidth = 3;
        const browOffset = 15 + intensity * 10;
        ctx.beginPath();
        ctx.moveTo(-face.r * 0.42, eyeY - browOffset - blink * 4);
        ctx.lineTo(-face.r * 0.18, eyeY - (browOffset - 4) - blink * 6);
        ctx.moveTo( face.r * 0.42, eyeY - browOffset - blink * 4);
        ctx.lineTo( face.r * 0.18, eyeY - (browOffset - 4) - blink * 6);
        ctx.stroke();

        // å˜´å·´
        ctx.fillStyle = '#ff6b6b';
        const mouthOpen = face.r * (0.18 + face.slapAnim * 0.3 + intensity * 0.15);
        ctx.beginPath();
        ctx.ellipse(
            0, 
            face.r * (0.25 + face.slapAnim * 0.15),
            face.r * 0.2 + intensity * face.r * 0.1,
            mouthOpen,
            0, 0, Math.PI * 2
        );
        ctx.fill();

        ctx.restore();
    }

    function drawParticles() {
        particles.forEach(p => {
            ctx.save();
            ctx.globalAlpha = p.life;
            ctx.fillStyle = p.color;
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.life * 5, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
        });
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // èƒŒæ™¯æ˜Ÿæ˜Ÿ
        ctx.fillStyle = 'rgba(255,255,255,0.3)';
        for (let i = 0; i < 20; i++) {
            const x = (i * 137.5) % canvas.width;
            const y = (i * 239.3) % canvas.height;
            ctx.beginPath();
            ctx.arc(x, y, 3, 0, Math.PI * 2);
            ctx.fill();
        }

        // åˆ†æ•¸ï¼šç•«é¢æœ€ä¸Šæ–¹æ¡†å¤–ã€é»‘è‰²å¤§å­—
        ctx.fillStyle = '#000000';
        ctx.font = `${Math.min(canvas.width / 7, 64)}px Impact, Arial`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'top';
        ctx.shadowColor = 'rgba(255,255,255,0.6)';
        ctx.shadowBlur = 6;
        ctx.fillText(`X ${score}`, canvas.width / 2, 4);
        ctx.shadowBlur = 0;

        drawFace();
        drawParticles();

        // æç¤ºæ–‡å­—
        ctx.fillStyle = '#e17055';
        ctx.font = `${Math.min(canvas.width / 15, 32)}px Arial`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'top';
        ctx.fillText('å•ªï¼ç”¨åŠ›æ‰“æˆ‘ï¼', canvas.width / 2, 40);
    }

    function gameLoop() {
        update();
        draw();
        requestAnimationFrame(gameLoop);
    }

    function handleSlap(clientX, clientY) {
        const rect = canvas.getBoundingClientRect();
        const x = clientX - rect.left;
        const y = clientY - rect.top;

        const dx = x - face.x;
        const dy = y - face.y;
        if (Math.sqrt(dx*dx + dy*dy) < face.r * 1.2) {
            score++;
            face.shake = 1.2;
            face.red = 40;
            face.slapAnim = 1;
            createParticles(x, y);

            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.frequency.value = 200;
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.1);
        }
    }

    canvas.addEventListener('click', e => handleSlap(e.clientX, e.clientY));
    canvas.addEventListener('touchstart', e => {
        e.preventDefault();
        handleSlap(e.touches[0].clientX, e.touches[0].clientY);
    });

    gameLoop();
</script>

</body>
</html>

