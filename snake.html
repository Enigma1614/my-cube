<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>è²ªé£Ÿè›‡ Snake</title>
  <style>
    :root{
      --bg:#0b1220;
      --panel:#101a30;
      --text:#e6eefc;
      --muted:#9fb2d6;
      --accent:#4cc9f0;
      --snake:#7CFF6B;
      --food:#ff4d6d;
      --grid:#172447;
      --shadow: 0 12px 28px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      background: radial-gradient(1200px 600px at 20% 20%, #152853 0%, var(--bg) 55%, #070b14 100%);
      font-family: sans-serif;
      color:var(--text);
      touch-action: manipulation; 
    }
    .wrap{ width:min(900px, 92vw); display:grid; gap:14px; grid-template-columns: 1fr; align-items:start; padding-bottom: 20px; }
    
    header{
      display:flex; justify-content:space-between; align-items:center; gap:12px;
      padding:14px 16px;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.10); border-radius:14px;
      box-shadow: var(--shadow); backdrop-filter: blur(6px);
    }
    .header-left { display: flex; align-items: center; gap: 15px; }
    header h1{ margin:0; font-size:18px; display:flex; align-items:center; gap:10px; }
    
    .home-btn {
        text-decoration: none; font-size: 20px; color: var(--text);
        background: rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 8px;
        transition: background 0.2s;
    }
    .home-btn:active { background: rgba(255,255,255,0.3); }

    .badge{ font-size:12px; color:#07111f; background:linear-gradient(90deg, var(--accent), #b8f2ff); padding:4px 8px; border-radius:999px; font-weight:700; }
    .stats{ display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; align-items:center; font-size:13px; color:var(--muted); }
    .stats b{ color:var(--text); font-weight:800; }
    
    .panel{ display:grid; grid-template-columns: 1fr 280px; gap:14px; }
    @media (max-width: 850px){ .panel{ grid-template-columns: 1fr; } }
    
    .game{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.10); border-radius:14px;
      box-shadow: var(--shadow); padding:14px;
      display: flex; flex-direction: column; align-items: center;
    }
    canvas{
      width:100%; height:auto; display:block; border-radius:12px;
      background: linear-gradient(var(--grid) 1px, transparent 1px), linear-gradient(90deg, var(--grid) 1px, transparent 1px), #061022;
      background-size: 24px 24px, 24px 24px; border:1px solid rgba(255,255,255,.08);
    }
    
    .side{ background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.10); border-radius:14px; box-shadow: var(--shadow); padding:14px; display:grid; gap:12px; height: fit-content; }
    .row{ display:flex; gap:10px; align-items:center; justify-content:space-between; }
    input[type="range"]{ width: 150px; accent-color: var(--accent); }
    .btns{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    button{ cursor:pointer; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06); color:var(--text); padding:10px 12px; border-radius:12px; font-weight:700; }
    .primary{ background: linear-gradient(90deg, rgba(76,201,240,.25), rgba(124,255,107,.18)); border-color: rgba(76,201,240,.35); }
    .hint{ font-size:12px; color:var(--muted); line-height:1.6; padding:10px 12px; border-radius:12px; background: rgba(0,0,0,.16); border:1px dashed rgba(255,255,255,.12); }
    
    .overlay{ position:absolute; inset:0; display:grid; place-items:center; pointer-events:none; z-index: 10; }
    .msg{ pointer-events:none; text-align:center; padding:12px 16px; border-radius:14px; background: rgba(0,0,0,.35); border:1px solid rgba(255,255,255,.12); backdrop-filter: blur(6px); }
    .msg h2{ margin:0 0 6px; font-size:18px;} .msg p{ margin:0; color:var(--muted); font-size:13px; }
    .rel{ position:relative; width: 100%; }

    .d-pad { margin-top: 20px; display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(2, 1fr); gap: 8px; width: 100%; max-width: 240px; }
    @media (min-width: 851px) { .d-pad { display: none; } }
    .d-btn { aspect-ratio: 1.2 / 1; font-size: 24px; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white;}
    .d-up { grid-column: 2; grid-row: 1; } .d-left { grid-column: 1; grid-row: 2; } .d-down { grid-column: 2; grid-row: 2; } .d-right { grid-column: 3; grid-row: 2; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="header-left">
        <a href="index.html" class="home-btn">ğŸ </a>
        <h1>è²ªé£Ÿè›‡ <span class="badge">Snake</span></h1>
      </div>
      <div class="stats">
        åˆ†æ•¸ï¼š<b id="score">0</b>
        ç‹€æ…‹ï¼š<b id="state">æš«åœ</b>
      </div>
    </header>

    <div class="panel">
      <section class="game">
        <div class="rel">
          <canvas id="c" width="600" height="600" aria-label="snake-canvas"></canvas>
          <div class="overlay" id="overlay">
            <div class="msg" id="msg">
              <h2>æŒ‰ä¸‹ ç©ºç™½éµ é–‹å§‹</h2>
              <p>æ–¹å‘éµ / WASD æ§åˆ¶</p>
            </div>
          </div>
        </div>
        <div class="d-pad">
          <button class="d-btn d-up" id="btnUp">â–²</button>
          <button class="d-btn d-left" id="btnLeft">â—€</button>
          <button class="d-btn d-down" id="btnDown">â–¼</button>
          <button class="d-btn d-right" id="btnRight">â–¶</button>
        </div>
      </section>

      <aside class="side">
        <div class="row"><label>é€Ÿåº¦</label><div><input id="speed" type="range" min="6" max="18" step="1" value="10"><span id="speedVal">10</span></div></div>
        <div class="row"><label>æ ¼å­å¤§å°</label><div><input id="cell" type="range" min="12" max="30" step="2" value="24"><span id="cellVal">24</span></div></div>
        <div class="btns"><button class="primary" id="toggle">é–‹å§‹ / æš«åœ</button><button id="restart">é‡æ–°é–‹å§‹</button></div>
        <div class="hint"><b>é›»è…¦ï¼š</b>ç©ºç™½éµé–‹å§‹ï¼Œæ–¹å‘éµç§»å‹•<br/><b>æ‰‹æ©Ÿï¼š</b>é»æ“ŠæŒ‰éˆ•æˆ–æ»‘å‹•è¢å¹•</div>
      </aside>
    </div>
  </div>

<script>
(() => {
  const canvas = document.getElementById('c'), ctx = canvas.getContext('2d');
  const elScore = document.getElementById('score'), elState = document.getElementById('state'), overlay = document.getElementById('overlay'), msgBox = document.getElementById('msg');
  const speedSlider = document.getElementById('speed'), cellSlider = document.getElementById('cell'), speedVal = document.getElementById('speedVal'), cellVal = document.getElementById('cellVal');
  const btnToggle = document.getElementById('toggle'), btnRestart = document.getElementById('restart');
  const btnUp = document.getElementById('btnUp'), btnDown = document.getElementById('btnDown'), btnLeft = document.getElementById('btnLeft'), btnRight = document.getElementById('btnRight');
  const LS_KEY = 'snake_best_score_v1';
  let best = Number(localStorage.getItem(LS_KEY) || 0);

  let cell = Number(cellSlider.value), cols = Math.floor(canvas.width/cell), rows = Math.floor(canvas.height/cell);
  let speed = Number(speedSlider.value), lastTime = 0, acc = 0, running = false, gameOver = false;
  let dir = {x:1, y:0}, nextDir = {x:1, y:0}, snake = [], food = {x:10, y:10}, score = 0;

  function reset(){
    score = 0; elScore.textContent = score; dir = {x:1, y:0}; nextDir = {x:1, y:0};
    const sx = Math.floor(cols/2), sy = Math.floor(rows/2);
    snake = [{x:sx-2, y:sy}, {x:sx-1, y:sy}, {x:sx, y:sy}];
    placeFood(); gameOver = false; updateStateText(); showOverlay('æº–å‚™é–‹å§‹', 'é›»è…¦æŒ‰ç©ºç™½éµï¼Œæ‰‹æ©ŸæŒ‰æ–¹å‘éµé–‹å§‹'); draw();
  }
  function updateGrid(){ cell = Number(cellSlider.value); cols = Math.floor(canvas.width/cell); rows = Math.floor(canvas.height/cell); cellVal.textContent = cell; }
  function placeFood(){
    const occupied = new Set(snake.map(p => `${p.x},${p.y}`));
    let x,y, tries=0; do{ x = Math.floor(Math.random()*cols); y = Math.floor(Math.random()*rows); tries++; if(tries>200)break; } while(occupied.has(`${x},${y}`));
    food = {x,y};
  }
  function updateStateText(){ elState.textContent = gameOver ? 'çµæŸ' : (running ? 'é€²è¡Œä¸­' : 'æš«åœ'); btnToggle.textContent = running ? 'æš«åœ' : 'é–‹å§‹'; }
  function showOverlay(title, subtitle){ overlay.style.display = 'grid'; msgBox.innerHTML = `<h2>${title}</h2><p>${subtitle}</p>`; }
  function hideOverlay(){ overlay.style.display = 'none'; }
  function toggle(){ if(gameOver){ reset(); } running = !running; updateStateText(); if(running) hideOverlay(); else showOverlay('å·²æš«åœ', 'æŒ‰ä¸‹ ç©ºç™½éµ æˆ–ã€Œé–‹å§‹ã€ç¹¼çºŒ'); }
  
  function step(){
    if((nextDir.x !== -dir.x) || (nextDir.y !== -dir.y)) dir = {...nextDir};
    const head = snake[snake.length-1], nx = head.x + dir.x, ny = head.y + dir.y;
    if(nx < 0 || nx >= cols || ny < 0 || ny >= rows) { endGame(); return; }
    const tail = snake[0], willEat = (nx === food.x && ny === food.y), bodySet = new Set(snake.map(p => `${p.x},${p.y}`));
    if(bodySet.has(`${nx},${ny}`)){ if(!(nx === tail.x && ny === tail.y && !willEat)){ endGame(); return; } }
    snake.push({x:nx, y:ny});
    if(willEat){ score+=10; elScore.textContent=score; if(score>best){ best=score; localStorage.setItem(LS_KEY, String(best)); } placeFood(); } else { snake.shift(); }
  }
  function endGame(){ running = false; gameOver = true; updateStateText(); showOverlay('Game Over', 'æŒ‰ R æˆ–ã€Œé‡æ–°é–‹å§‹ã€å†ä¾†ä¸€å±€'); }
  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawCell(food.x, food.y, '#ff4d6d', true);
    for(let i=0; i<snake.length; i++){ const p=snake[i], t=i/Math.max(1,snake.length-1), col=lerpColor('#44d86f','#7CFF6B',t), isHead=i===snake.length-1; drawCell(p.x, p.y, col, isHead); }
  }
  function drawCell(x,y,color,glow=false){
    const px=x*cell, py=y*cell, pad=Math.max(2,Math.floor(cell*0.12)), r=Math.max(6,Math.floor(cell*0.25));
    if(glow){ ctx.save(); ctx.shadowColor=color; ctx.shadowBlur=14; roundRect(px+pad, py+pad, cell-pad*2, cell-pad*2, r, color); ctx.restore(); } else { roundRect(px+pad, py+pad, cell-pad*2, cell-pad*2, r, color); }
  }
  function roundRect(x,y,w,h,r,fill){ ctx.beginPath(); ctx.moveTo(x+r, y); ctx.arcTo(x+w, y, x+w, y+h, r); ctx.arcTo(x+w, y+h, x, y+h, r); ctx.arcTo(x, y+h, x, y, r); ctx.arcTo(x, y, x+w, y, r); ctx.closePath(); ctx.fillStyle = fill; ctx.fill(); ctx.strokeStyle = 'rgba(255,255,255,.10)'; ctx.lineWidth = 1; ctx.stroke(); }
  function lerpColor(a,b,t){ const pa=hexToRgb(a), pb=hexToRgb(b), r=Math.round(pa.r+(pb.r-pa.r)*t), g=Math.round(pa.g+(pb.g-pa.g)*t), bl=Math.round(pa.b+(pb.b-pa.b)*t); return `rgb(${r},${g},${bl})`; }
  function hexToRgb(hex){ const h=hex.replace('#',''), bigint=parseInt(h.length===3?h.split('').map(c=>c+c).join(''):h,16); return {r:(bigint>>16)&255, g:(bigint>>8)&255, b:bigint&255}; }
  function loop(ts){ const dt=(ts-lastTime)/1000||0; lastTime=ts; const targetStep=1/speed; if(running&&!gameOver){ acc+=dt; while(acc>=targetStep){ step(); acc-=targetStep; } } draw(); requestAnimationFrame(loop); }
  
  window.addEventListener('keydown', (e)=>{ const k=e.key.toLowerCase(); if(k===' '){ e.preventDefault(); toggle(); return; } if(k==='r'){ reset(); return; } if(k==='arrowup'||k==='w')setDir(0,-1); else if(k==='arrowdown'||k==='s')setDir(0,1); else if(k==='arrowleft'||k==='a')setDir(-1,0); else if(k==='arrowright'||k==='d')setDir(1,0); });
  function setDir(x,y){ if(!running&&!gameOver){ running=true; updateStateText(); hideOverlay(); } nextDir = {x,y}; }
  function bindTouch(btn, x, y) { const h=(e)=>{ if(e.cancelable)e.preventDefault(); setDir(x,y); }; btn.addEventListener('touchstart', h, {passive:false}); btn.addEventListener('mousedown', h); }
  bindTouch(btnUp, 0, -1); bindTouch(btnDown, 0, 1); bindTouch(btnLeft, -1, 0); bindTouch(btnRight, 1, 0);
  speedSlider.addEventListener('input', ()=>{ speed=Number(speedSlider.value); speedVal.textContent=speed; });
  cellSlider.addEventListener('input', ()=>{ updateGrid(); reset(); });
  btnToggle.addEventListener('click', toggle); btnRestart.addEventListener('click', ()=>reset());
  let touchStart = null;
  canvas.addEventListener('touchstart', (e)=>{ const t=e.changedTouches[0]; touchStart={x:t.clientX, y:t.clientY}; }, {passive:true});
  canvas.addEventListener('touchend', (e)=>{ if(!touchStart)return; const t=e.changedTouches[0], dx=t.clientX-touchStart.x, dy=t.clientY-touchStart.y; if(Math.max(Math.abs(dx),Math.abs(dy))<30)return; if(Math.abs(dx)>Math.abs(dy)) setDir(dx>0?1:-1,0); else setDir(0,dy>0?1:-1); touchStart=null; }, {passive:true});
  
  speedVal.textContent = speed; updateGrid(); reset(); requestAnimationFrame(loop);
})();
</script>
</body>
</html>
