<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>æ¥µé™è²ªé£Ÿè›‡ Pro</title>
  <style>
    :root { --bg: #0b1220; --accent: #4cc9f0; --grid: rgba(60, 80, 120, 0.3); }
    body {
      margin: 0; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
      background: radial-gradient(circle at center, #152853 0%, var(--bg) 90%);
      font-family: system-ui, -apple-system, sans-serif; color: #fff; overflow: hidden; touch-action: none; user-select: none;
    }
    
    /* é ‚éƒ¨å°èˆªåˆ— */
    header {
      width: 100%; padding: 10px 20px; box-sizing: border-box;
      display: flex; justify-content: space-between; align-items: center;
      background: rgba(0,0,0,0.3); border-bottom: 1px solid rgba(255,255,255,0.1);
      flex-shrink: 0; z-index: 20;
    }
    .header-left { display: flex; align-items: center; gap: 12px; }
    .home-btn {
        text-decoration: none; font-size: 18px; color: #fff;
        background: rgba(255,255,255,0.1); width: 36px; height: 36px;
        display: flex; align-items: center; justify-content: center;
        border-radius: 8px; border: 1px solid rgba(255,255,255,0.2);
        transition: 0.2s;
    }
    .home-btn:active { background: var(--accent); color: #000; }
    .score-box { font-size: 20px; font-weight: 800; color: var(--accent); font-family: monospace; }

    /* éŠæˆ²ä¸»é«”å®¹å™¨ (å½ˆæ€§ä¼¸ç¸®) */
    .main-area {
        flex-grow: 1; width: 100%; display: flex; flex-direction: column; 
        align-items: center; justify-content: center; position: relative;
    }

    /* ç•«å¸ƒå¤–æ¡† */
    .game-container { 
        position: relative; 
        border-radius: 12px; overflow: hidden; 
        box-shadow: 0 0 40px rgba(76, 201, 240, 0.15);
        border: 2px solid rgba(255,255,255,0.1);
        background: #061022;
    }
    
    canvas {
      display: block;
      /* CSS ç¶²æ ¼èƒŒæ™¯ (èˆ‡ JS é‚è¼¯å°é½Š) */
      background-image: linear-gradient(var(--grid) 1px, transparent 1px), linear-gradient(90deg, var(--grid) 1px, transparent 1px);
      background-size: var(--cell) var(--cell);
    }

    /* ä¿®æ­£å¾Œçš„åŠé€æ˜é®ç½© */
    #overlay {
      position: absolute; inset: 0; 
      background: rgba(0, 0, 0, 0.6); /* åŠé€æ˜ï¼Œçœ‹å¾—åˆ°å¾Œé¢ */
      backdrop-filter: blur(3px); /* è¼•å¾®æ¨¡ç³Š */
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      z-index: 10;
    }
    
    h2 { margin: 0 0 10px 0; font-size: 32px; text-shadow: 0 0 15px currentColor; color: #fff; }
    p { color: #ddd; font-size: 14px; margin-bottom: 25px; opacity: 0.8; }
    
    button#startBtn {
      padding: 12px 35px; font-size: 18px; font-weight: bold;
      background: var(--accent); border: none; border-radius: 50px;
      color: #000; cursor: pointer; box-shadow: 0 0 20px var(--accent);
      transition: transform 0.1s;
    }
    button#startBtn:active { transform: scale(0.95); }

    /* åº•éƒ¨æ§åˆ¶å™¨ (æ‰‹æ©Ÿé¡¯ç¤ºï¼Œé›»è…¦éš±è—) */
    .d-pad {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;
      width: 150px; margin-bottom: 20px; flex-shrink: 0;
    }
    .d-btn {
      aspect-ratio: 1; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15);
      border-radius: 50%; display: flex; align-items: center; justify-content: center;
      color: #fff; font-size: 22px; cursor: pointer;
    }
    .d-btn:active { background: rgba(76, 201, 240, 0.5); border-color: var(--accent); }
    
    @media (min-width: 800px) { .d-pad { display: none; } }
  </style>
</head>
<body>

  <header>
    <div class="header-left">
        <a href="index.html" class="home-btn">ğŸ </a>
        <div style="font-weight:900; letter-spacing:1px; margin-left:10px;">SNAKE <span style="color:var(--accent)">PRO</span></div>
    </div>
    <div class="score-box">SCORE: <span id="scoreVal">0</span></div>
  </header>

  <div class="main-area">
      <div class="game-container" id="gContainer">
        <canvas id="snakeCanvas"></canvas>
        <div id="overlay">
          <h2 id="m-title">READY?</h2>
          <p>æ»‘å‹•è¢å¹•æˆ–æŒ‰ä¸‹æŒ‰éˆ•é–‹å§‹</p>
          <button id="startBtn">START GAME</button>
        </div>
      </div>
  </div>

  <div class="d-pad">
    <div style="grid-column:2"><div class="d-btn" id="c-up">â–²</div></div>
    <div style="grid-column:1"><div class="d-btn" id="c-left">â—€</div></div>
    <div style="grid-column:2"><div class="d-btn" id="c-down">â–¼</div></div>
    <div style="grid-column:3"><div class="d-btn" id="c-right">â–¶</div></div>
  </div>

<script>
(() => {
  const canvas = document.getElementById('snakeCanvas');
  const ctx = canvas.getContext('2d');
  const container = document.getElementById('gContainer');
  const scoreEl = document.getElementById('scoreVal');
  const overlay = document.getElementById('overlay');
  
  let audioCtx, cols = 20, rows = 20, cell, dpr;
  let snake = [], food = {}, dir = {x:0, y:-1}, nextDir = {x:0, y:-1};
  let score = 0, isRunning = false;
  
  // éŸ³æ•ˆ
  function playNote(f, type='sine', d=0.1) {
    if(!audioCtx || audioCtx.state !== 'running') return;
    const o = audioCtx.createOscillator(), g = audioCtx.createGain();
    o.type = type; o.frequency.setValueAtTime(f, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + d);
    o.connect(g); g.connect(audioCtx.destination);
    o.start(); o.stop(audioCtx.currentTime + d);
  }

  // ç•«é¢é©é…èˆ‡åˆå§‹åŒ–
  function setupGrid() {
    dpr = window.devicePixelRatio || 1;
    // è¨ˆç®—å¯ç”¨çš„æœ€å¤§å¯¬åº¦ (ä¿ç•™ä¸Šä¸‹é‚Šè·)
    const maxW = Math.min(window.innerWidth * 0.95, 500);
    const maxH = window.innerHeight * 0.6; // ç•™ç©ºé–“çµ¦æ§åˆ¶å™¨
    const size = Math.min(maxW, maxH);
    
    // è¨­å®šå®¹å™¨å°ºå¯¸
    container.style.width = size + "px";
    container.style.height = size + "px";
    
    cell = size / cols;
    canvas.width = size * dpr;
    canvas.height = size * dpr;
    ctx.scale(dpr, dpr);
    
    // æ›´æ–° CSS è®Šæ•¸ä»¥å°é½Šç¶²æ ¼
    document.documentElement.style.setProperty('--cell', cell + 'px');
    
    if(!isRunning) draw(); // è¦–çª—æ”¹è®Šæ™‚é‡ç•«ï¼Œç¢ºä¿ç•«é¢ä¸æ¶ˆå¤±
  }
  window.addEventListener('resize', setupGrid);

  function spawnFood() {
    food = { x: Math.floor(Math.random()*cols), y: Math.floor(Math.random()*rows), type: Math.random()<0.1?'star':(Math.random()<0.2?'pill':'normal') };
    // é¿å…ç”Ÿæˆåœ¨è›‡èº«ä¸Š
    if(snake.some(p => p.x === food.x && p.y === food.y)) spawnFood();
  }

  function reset() {
    score = 0; scoreEl.textContent = score;
    const mid = Math.floor(cols/2);
    // é è¨­è›‡çš„ä½ç½®
    snake = [{x:mid, y:mid}, {x:mid, y:mid+1}, {x:mid, y:mid+2}];
    dir = {x:0, y:-1}; nextDir = {x:0, y:-1};
    spawnFood();
    isRunning = false;
    overlay.style.display = 'flex';
    document.getElementById('m-title').innerText = "READY?";
    
    // é—œéµï¼šé‡ç½®å¾Œç«‹å³ç¹ªè£½ä¸€æ¬¡ï¼Œè®“ç©å®¶é€éåŠé€æ˜è¦–çª—çœ‹åˆ°è›‡
    draw();
  }

  function step() {
    if(!isRunning) return;
    dir = nextDir;
    const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };
    
    // ç¢°æ’æª¢æ¸¬
    if(head.x<0 || head.x>=cols || head.y<0 || head.y>=rows || snake.some(p=>p.x===head.x && p.y===head.y)) {
      playNote(150, 'sawtooth', 0.5); 
      isRunning = false;
      document.getElementById('m-title').innerText = "GAME OVER";
      overlay.style.display = 'flex';
      return;
    }

    snake.unshift(head);
    
    if(head.x===food.x && head.y===food.y) {
      if(food.type==='star') { score+=30; playNote(800, 'square'); }
      else if(food.type==='pill') { score+=5; playNote(400, 'sine'); snake.pop(); snake.pop(); }
      else { score+=10; playNote(600, 'triangle'); }
      scoreEl.textContent = score; spawnFood();
    } else {
      snake.pop();
    }
    // é€Ÿåº¦éš¨åˆ†æ•¸å¢åŠ 
    setTimeout(step, Math.max(70, 150 - score/2));
  }

  function draw() {
    ctx.clearRect(0,0,canvas.width/dpr, canvas.height/dpr); // æ¸…é™¤ç•«å¸ƒ
    
    // ç•«é£Ÿç‰©
    const fx=food.x*cell, fy=food.y*cell, p=cell*0.15, s=cell-p*2;
    ctx.fillStyle = food.type==='star'?'#ffcf33':(food.type==='pill'?'#4cc9f0':'#ff4d6d');
    ctx.shadowBlur = 15; ctx.shadowColor = ctx.fillStyle;
    ctx.beginPath(); ctx.roundRect(fx+p, fy+p, s, s, s/2); ctx.fill();
    ctx.shadowBlur = 0;

    // ç•«è›‡
    snake.forEach((p, i) => {
      ctx.fillStyle = i===0 ? '#fff' : '#7CFF6B';
      const x=p.x*cell, y=p.y*cell;
      ctx.beginPath(); ctx.roundRect(x+1, y+1, cell-2, cell-2, 4); ctx.fill();
      
      if(i===0) { // ç•«çœ¼ç›ï¼Œå¢åŠ æ–¹å‘æ„Ÿ
        ctx.fillStyle='#000';
        const eyeOff = cell*0.2;
        const eyeSize = cell*0.15;
        const cx = x + cell/2, cy = y + cell/2;
        // æ ¹æ“šæ–¹å‘èª¿æ•´çœ¼ç›ä½ç½®
        ctx.beginPath(); 
        ctx.arc(cx + dir.y*eyeOff + dir.x*eyeOff, cy + dir.x*eyeOff + dir.y*eyeOff, eyeSize, 0, Math.PI*2); 
        ctx.arc(cx - dir.y*eyeOff + dir.x*eyeOff, cy - dir.x*eyeOff + dir.y*eyeOff, eyeSize, 0, Math.PI*2);
        ctx.fill();
      }
    });
    
    if(isRunning) requestAnimationFrame(draw);
  }

  const input = (x,y) => { 
    if(x!==-dir.x && y!==-dir.y) nextDir={x,y}; 
  };
  
  // æŒ‰éˆ•ç¶å®š
  document.getElementById('c-up').onclick = () => input(0,-1);
  document.getElementById('c-down').onclick = () => input(0,1);
  document.getElementById('c-left').onclick = () => input(-1,0);
  document.getElementById('c-right').onclick = () => input(1,0);
  
  // éµç›¤ç¶å®š
  window.addEventListener('keydown', e => {
      if(e.key==='ArrowUp' || e.key==='w') input(0,-1);
      if(e.key==='ArrowDown' || e.key==='s') input(0,1);
      if(e.key==='ArrowLeft' || e.key==='a') input(-1,0);
      if(e.key==='ArrowRight' || e.key==='d') input(1,0);
      if(e.code==='Space' && !isRunning) document.getElementById('startBtn').click();
  });

  // æ»‘å‹•æ“ä½œ (Swipe)
  let sx=0, sy=0;
  canvas.addEventListener('touchstart', e => { sx=e.touches[0].clientX; sy=e.touches[0].clientY; }, {passive:false});
  canvas.addEventListener('touchend', e => {
    const dx=e.changedTouches[0].clientX-sx, dy=e.changedTouches[0].clientY-sy;
    if(Math.abs(dx) > Math.abs(dy)) { 
        if(Math.abs(dx)>30) input(dx>0?1:-1, 0); 
    } else { 
        if(Math.abs(dy)>30) input(0, dy>0?1:-1); 
    }
  });

  document.getElementById('startBtn').onclick = () => {
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if(audioCtx.state === 'suspended') audioCtx.resume();
    overlay.style.display = 'none';
    isRunning = true; 
    draw(); // å•Ÿå‹•ç¹ªåœ–è¿´åœˆ
    step(); // å•Ÿå‹•é‚è¼¯è¿´åœˆ
  };

  setupGrid();
  reset();
})();
</script>
</body>
</html>
