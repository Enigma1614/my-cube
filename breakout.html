<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è±ªè¯ç‰ˆï¼šæ¥µé™çˆ†ç ´ ğŸ§±</title>
    <style>
        body { background: #000; color: white; margin: 0; overflow: hidden; touch-action: none; font-family: "Microsoft JhengHei", sans-serif; }
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        #header { padding: 15px; display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.5); }
        .score-box { font-size: 24px; font-weight: bold; color: #f1c40f; text-shadow: 0 0 10px #f1c40f; }
        #powerup-status { position: absolute; bottom: 100px; width: 100%; text-align: center; font-size: 22px; color: #0f0; text-shadow: 0 0 10px #0f0; opacity: 0; transition: 0.3s; font-weight: bold; }
        #overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10; }
        h1 { margin: 0; font-size: 45px; color: #ff0055; text-shadow: 0 0 20px red; }
        button { padding: 15px 45px; font-size: 24px; background: #00d2ff; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; margin-top: 20px; box-shadow: 0 0 20px #00d2ff; }
        .hint { color: #888; font-size: 14px; margin-top: 10px; }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="ui-layer">
        <div id="header">
            <div style="color:#aaa">â¤ï¸ ç„¡é™æ¨¡å¼</div>
            <div class="score-box">å¾—åˆ†: <span id="scoreVal">0</span></div>
        </div>
        <div id="powerup-status"></div>
    </div>
    <div id="overlay">
        <h1>æ¥µé™çˆ†ç ´ 2.0</h1>
        <p>æ‘§æ¯€ BOSS é‡‘ç£šï¼Œæ”¶é›†å¼·åŠ›é“å…·ï¼</p>
        <button onclick="startGame()">ğŸš€ å•Ÿå‹•å¼•æ“</button>
        <div class="hint">( é»æ“ŠæŒ‰éˆ•å¾Œå°‡é–‹å•ŸéŸ³æ¨‚èˆ‡éŸ³æ•ˆ )</div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let canvasW, canvasH, animationId, isPlaying = false;
        let score = 0, hitCount = 0, speedMult = 1;

        // --- éŸ³é »å¼•æ“ (Web Audio API) ---
        let audioCtx;
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                startBGM();
            }
        }

        function playSound(type) {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            const now = audioCtx.currentTime;
            if (type === 'hit') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(440, now);
                osc.frequency.exponentialRampToValueAtTime(110, now + 0.1);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.1);
                osc.start(); osc.stop(now + 0.1);
            } else if (type === 'boss') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(220, now);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.2);
                osc.start(); osc.stop(now + 0.2);
            } else if (type === 'explosion') {
                const bufferSize = audioCtx.sampleRate * 0.2;
                const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
                const data = buffer.getChannelData(0);
                for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
                const noise = audioCtx.createBufferSource();
                noise.buffer = buffer;
                const noiseGain = audioCtx.createGain();
                noiseGain.gain.setValueAtTime(0.2, now);
                noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
                noise.connect(noiseGain); noiseGain.connect(audioCtx.destination);
                noise.start();
            } else if (type === 'powerup') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(200, now);
                osc.frequency.exponentialRampToValueAtTime(800, now + 0.3);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.3);
                osc.start(); osc.stop(now + 0.3);
            }
        }

        function startBGM() {
            const loop = () => {
                if(!isPlaying) return;
                const now = audioCtx.currentTime;
                const notes = [110, 130, 146, 164];
                notes.forEach((f, i) => {
                    const osc = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(f, now + i * 0.5);
                    g.gain.setValueAtTime(0.02, now + i * 0.5);
                    g.gain.linearRampToValueAtTime(0, now + i * 0.5 + 0.4);
                    osc.connect(g); g.connect(audioCtx.destination);
                    osc.start(now + i * 0.5); osc.stop(now + i * 0.5 + 0.4);
                });
                setTimeout(loop, 2000);
            };
            loop();
        }

        // --- éŠæˆ²é‚è¼¯ ---
        const BRICK_COL_COUNT = 6;
        let bricks = [], balls = [], particles = [], currentPaddleWidth, paddleX;
        let powerups = { long: 0, fireball: 0, shield: 0, fast: 0 };

        function resize() {
            canvasW = window.innerWidth; canvasH = window.innerHeight;
            canvas.width = canvasW; canvas.height = canvasH;
            paddleX = canvasW / 2 - 50;
        }
        window.addEventListener('resize', resize); resize();

        function spawnRow() {
            bricks.forEach(b => { b.row++; b.targetY = b.row * 35 + 80; });
            for(let c=0; c<BRICK_COL_COUNT; c++) {
                let r = Math.random(), type = 'NORMAL', color = `hsl(${Math.random()*360}, 60%, 50%)`, hits = 1;
                if (r < 0.1) { type = 'BOSS'; color = '#FFD700'; hits = 3; }
                else if (r < 0.15) { type = 'BOMB'; color = '#ff0055'; }
                else if (r < 0.20) { type = 'LONG'; color = '#00ff00'; }
                else if (r < 0.25) { type = 'FIREBALL'; color = '#ffaa00'; }
                else if (r < 0.30) { type = 'SHIELD'; color = '#00d2ff'; }
                else if (r < 0.35) { type = 'SPEED'; color = '#cc00ff'; }

                bricks.push({ x: c * (canvasW/BRICK_COL_COUNT) + 5, y: -30, targetY: 80, row: 0, col: c, status: 1, type, color, hits });
            }
        }

        function activatePowerup(type) {
            playSound('powerup');
            let msg = "";
            if (type === 'LONG') { powerups.long = Date.now() + 10000; msg = "ğŸ“ æ“‹æ¿åŠ é•·ï¼"; }
            else if (type === 'FIREBALL') { powerups.fireball = Date.now() + 8000; msg = "ğŸ”¥ è¶…ç´šç«çƒï¼"; }
            else if (type === 'SHIELD') { powerups.shield = Date.now() + 15000; msg = "ğŸ›¡ï¸ åº•éƒ¨è­·ç›¾ï¼"; }
            else if (type === 'SPEED') { powerups.fast = Date.now() + 5000; msg = "ğŸš€ æ¥µé€Ÿè¡åˆºï¼"; }
            const el = document.getElementById('powerup-status');
            el.innerText = msg; el.style.opacity = 1;
            setTimeout(() => el.style.opacity = 0, 2000);
        }

        function update() {
            if(!isPlaying) return;
            
            speedMult = (Date.now() < powerups.fast) ? 1.8 : 1.0;
            let targetW = (Date.now() < powerups.long) ? 180 : 100;
            currentPaddleWidth = (currentPaddleWidth || 100) + (targetW - (currentPaddleWidth || 100)) * 0.1;

            bricks.forEach((b, idx) => {
                b.y += (b.targetY - b.y) * 0.1;
                if (b.status === 1 && b.y > canvasH - 80) gameOver("åŸå¸‚æ·ªé™·", "ç£šå¡Šå£“åˆ°äº†åº•ç·šï¼");
            });

            balls.forEach(ball => {
                if(!ball.active) return;
                ball.x += ball.dx * speedMult; ball.y += ball.dy * speedMult;

                if(ball.x < 8 || ball.x > canvasW - 8) { ball.dx *= -1; playSound('hit'); }
                if(ball.y < 8) { ball.dy *= -1; playSound('hit'); }

                if(ball.y > canvasH - 60 && ball.y < canvasH - 40 && ball.dy > 0) {
                    if(ball.x > paddleX && ball.x < paddleX + currentPaddleWidth) {
                        ball.dy *= -1; playSound('hit');
                        ball.dx = (ball.x - (paddleX + currentPaddleWidth/2)) / (currentPaddleWidth/2) * 6;
                    }
                }
                if(Date.now() < powerups.shield && ball.y > canvasH - 15) { ball.dy *= -1; playSound('hit'); }
                if(ball.y > canvasH + 20) ball.active = false;

                bricks.forEach((b, i) => {
                    if(b.status === 1 && ball.x > b.x && ball.x < b.x + (canvasW/BRICK_COL_COUNT)-10 && ball.y > b.y && ball.y < b.y + 25) {
                        if (Date.now() < powerups.fireball) {} else { ball.dy *= -1; }
                        b.hits--;
                        if(b.hits <= 0) {
                            b.status = 0; score += (b.type === 'BOSS' ? 50 : 10);
                            if(b.type === 'BOMB') { playSound('explosion'); triggerBomb(b.col, b.row); }
                            else { playSound('hit'); }
                            if(b.type !== 'NORMAL' && b.type !== 'BOMB' && b.type !== 'BOSS') activatePowerup(b.type);
                        } else {
                            playSound('boss');
                        }
                        hitCount++;
                        if(hitCount % 10 === 0) spawnRow();
                    }
                });
            });

            if(balls.filter(b=>b.active).length === 0) gameOver("éŠæˆ²çµæŸ", "çƒå…¨éƒ¨æ‰è½äº†");
            particles.forEach((p, i) => { p.x += p.vx; p.y += p.vy; p.life -= 0.02; if(p.life<=0) particles.splice(i,1); });
        }

        function triggerBomb(col, row) {
            bricks.forEach((b, i) => {
                let dist = Math.sqrt(Math.pow(b.col-col, 2) + Math.pow(b.row-row, 2));
                if(dist < 1.9 && b.status === 1) { b.status = 0; score += 10; }
            });
        }

        function draw() {
            ctx.fillStyle = '#050510'; ctx.fillRect(0,0,canvasW,canvasH);
            if(Date.now() < powerups.shield) { ctx.fillStyle = '#00d2ff55'; ctx.fillRect(0, canvasH-10, canvasW, 10); }

            bricks.forEach(b => {
                if(b.status !== 1) return;
                ctx.fillStyle = b.color;
                ctx.shadowBlur = (b.type === 'NORMAL') ? 0 : 15; ctx.shadowColor = b.color;
                ctx.beginPath(); ctx.roundRect(b.x, b.y, (canvasW/BRICK_COL_COUNT)-10, 25, 5); ctx.fill();
                ctx.shadowBlur = 0;
                ctx.fillStyle = "white"; ctx.font = "bold 14px Arial";
                if(b.type === 'BOSS') ctx.fillText(b.hits, b.x + 20, b.y + 18);
                else if(b.type === 'BOMB') ctx.fillText('ğŸ’£', b.x + 15, b.y + 18);
                else if(b.type === 'SPEED') ctx.fillText('ğŸš€', b.x + 15, b.y + 18);
            });

            ctx.fillStyle = (Date.now() < powerups.long) ? '#0f0' : '#00d2ff';
            ctx.beginPath(); ctx.roundRect(paddleX, canvasH - 50, currentPaddleWidth, 15, 10); ctx.fill();

            balls.forEach(ball => {
                if(!ball.active) return;
                ctx.fillStyle = (Date.now() < powerups.fireball) ? '#f40' : 'white';
                ctx.beginPath(); ctx.arc(ball.x, ball.y, 8, 0, Math.PI*2); ctx.fill();
            });

            document.getElementById('scoreVal').innerText = score;
            animationId = requestAnimationFrame(() => { update(); draw(); });
        }

        function startGame() {
            initAudio();
            document.getElementById('overlay').style.display = 'none';
            score = 0; hitCount = 0; bricks = []; balls = []; isPlaying = true;
            spawnRow(); spawnRow(); spawnRow();
            balls.push({ x: canvasW/2, y: canvasH-100, dx: 4, dy: -4, active: true });
            draw();
        }

        function gameOver(t, d) {
            isPlaying = false; cancelAnimationFrame(animationId);
            document.getElementById('overlay').style.display = 'flex';
            document.getElementById('overlay').querySelector('h1').innerText = t;
            document.getElementById('overlay').querySelector('p').innerText = d + " å¾—åˆ†: " + score;
        }

        document.addEventListener('mousemove', e => { paddleX = e.clientX - currentPaddleWidth/2; });
        document.addEventListener('touchmove', e => { e.preventDefault(); paddleX = e.touches[0].clientX - currentPaddleWidth/2; }, {passive:false});
    </script>
</body>
</html>
